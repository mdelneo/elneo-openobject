<?xml version="1.0" encoding="utf-8"?>
<openerp>
	<data>
		<!-- Cleanup -->
		<record id="elneo_views_maintenance_intervention_maintenance_product_tree" model="ir.ui.view">
			<field name="name">elneo.views.maintenance.intervention.maintenance.product.tree</field>
			<field name="model">maintenance.intervention</field>
			<field name="inherit_id" ref="maintenance_product.view_maintenance_intervention_maintenance_product_tree"/>
			<field name="arch" type="xml">
				<field name="available" 	position="replace"/>
				<field name="task_state" 	position="replace"/>
				<field name="sale_order_id" position="replace"/>
			</field>
		</record>
		
		<record id="elneo_views_maintenance_intervention_tree_inherit" model="ir.ui.view">
			<field name="name">elneo.views.maintenance.intervention.tree.inherit</field>
			<field name="model">maintenance.intervention</field>
			<field name="inherit_id" ref="maintenance_model.view_maintenance_intervention_tree_inherit"/>
			<field name="arch" type="xml">
				<field name="project_id" 	position="replace"/>
			</field>		
		</record>
		
		<record id="elneo_views_view_maintenance_internal_search_elneo" model="ir.ui.view">
			<field name="name">elneo.views.maintenance.intervention.internal.search</field>
            <field name="model">maintenance.intervention</field>
            <field name="inherit_id" ref="elneo_maintenance.view_maintenance_intervention_search_elneo"/>
            <field name="arch" type="xml">
            	<xpath expr="//filter[@name='done']" position="replace"/>
            	<xpath expr="//filter[@name='my_warehouse']" position="replace"/>
            	<xpath expr="//group[@string='Elneo']" position="replace"/>
            </field>
        </record>
        
        <record id="elneo_views_view_maintenance_intervention_elneo_tree" model="ir.ui.view">
        	<field name="name">elneo.views.maintenance.intervention.elneo.tree</field>
        	<field name="model">maintenance.intervention</field>
        	<field name="inherit_id" ref="elneo_maintenance.view_maintenance_intervention_elneo_tree"/>
        	<field name="arch" type="xml">
        		<field name="blocked" position="replace"/>
        		<field name="installation_zip" position="replace"/>
        		<xpath expr="//tree" position="attributes">
        			<attribute name="colors"></attribute>
        		</xpath>
        	</field>
        </record>
		
		<!-- <record id="elneo_views_maintenance_invervention_elneo" -->
		
 	<!-- 	<record id="elneo_views_maintenance_intervention_form_elneo" model="ir.ui.view">
			<field name="name">elneo.views.maintenance.intervention.form.elneo</field>
			<field name="model">maintenance.intervention</field>
			<field name="inherit_id" ref="elneo_maintenance.view_maintenance_intervention_form_elneo"/>
			<field name="arch" type="xml">
				<xpath expr="//field[@name='serial_number']" position="replace"/>
				<xpath expr="//page[@string='Content']" position="replace"/>
			</field>
		</record>		 -->
		
		<record id="elneo_views_maintenance_invervention_form_elneo" model="ir.ui.view">
			<field name="name">elneo.views.maintenance.invervention.form.elneo</field>
			<field name="model">maintenance.intervention</field>
			<field name="inherit_id" ref="elneo_maintenance.view_maintenance_intervention_form_elneo"/>
			<field name="arch" type="xml">
				<field name="real_stock" position="replace"/>
				<field name="virtual_stock" position="replace"/>
				<field name="procurement_path" position="replace"/>
			</field>
		</record>
		
		<record id="elneo_views_maintenance_intervention_form_failure_type" model="ir.ui.view">
			<field name="name">elneo.views.maintenance.invervention.form.failure.type</field>
			<field name="model">maintenance.intervention</field>
			<field name="inherit_id" ref="maintenance_failure_type.view_maintenance_intervention_form_failure_type"/>
			<field name="arch" type="xml">
				<field name="is_reparation" position="replace"/>
				<field name="failure_type_id" position="replace"/>
				<field name="failure_element_id" position="replace"/>
			</field>
		</record>
		
		<record id="elneo_views_maintenance_todo_tree" model="ir.ui.view">
			<field name="name">elneo.views.maintenance.todo.tree</field>
			<field name="model">maintenance.todo</field>
			<field name="inherit_id" ref="maintenance_todo.view_maintenance_todo_tree"/>
			<field name="arch" type="xml">
				<field name="code" position="replace"/>
				<field name="installation_id" position="replace"/>
				<field name="summary" position="replace"/>
				<field name="ask_user_id" position="replace"/>
				<field name="ask_date" position="replace"/>
				<field name="assigned_user_id" position="replace"/>
				<field name="done_date" position="replace"/>
				<field name="state" position="replace"/>
				<field name="intervention_assign_id" invisible="1" position="replace"/>				
			</field>
		</record>
		
		<record id="elneo_views_maintenance_intervention_todo_form" model="ir.ui.view">
			<field name="name">elneo.views.maintenance.intervention.todo.form</field>
			<field name="model">maintenance.intervention</field>
			<field name="inherit_id" ref="maintenance_todo.view_maintenance_intervention_todo_form"/>
			<field name="type">form</field>
			<field name="arch" type="xml">
				<xpath expr="//field[@name='todo_assigned_ids']/.." position="replace"/>
				<!-- <field name="todo_ids" position="replace"/>
				<field name="todo_assigned_ids" position="replace"/> -->
			</field>
		</record>
		
		<!-- Content -->
		<record id="elneo_views_maintenance_intervention_search" model="ir.ui.view">
            <field name="name">elneo.views.maintenance.intervention.search</field>
            <field name="model">maintenance.intervention</field>
            <field name="inherit_id" ref="maintenance.view_maintenance_intervention_search"/>
            <field name="type">search</field>
            <field name="arch" type="xml">
            	<search position="replace">
	                <search string="Interventions">
	                	<filter name="my_warehouse" string="My Warehouse" domain="[('installation_id.warehouse_id.default_user_ids','in',uid)]"/>
						<separator/>
	                    <group col="8" colspan="4">
	                        <field name="code" />
							<field name="name" />
							<field name="installation_id" />
							<field name="technicians" />					
							<field name="address_id" />
							<field name="partner_id" />
							<field name="state" />
							<field name="task_state" />
	                    </group>
	                    <group string="Filter">
	                    	<filter name="message_unread" string="My Interventions confirmed" domain="['&amp;', ('tasks.user_id.id','=',uid),('state', '=', 'confirmed')]" help="Interventions that have tasks assigned to me and state in confirmed"/>
	                    	<filter name="to_confirm" string="To confirm" domain="[('state','=','draft')]" help="Interventions that have state in draft"/>
	                    	<filter name="confirmed" string="Confirmed" domain="[('state','=','confirmed')]" help="Interventions that have state in confirmed"/>
	                        <filter name="done" string="Finished" domain="[('state','=','done')]" help="Interventions that have state in done"/>
	                    </group>
               			<group string="Elneo">
               				<filter name="awans" string="Awans" domain="[('installation_id.warehouse_id','=',1)]" help="Awans Interventions"/>
               				<filter name="wetteren" string="Wetteren" domain="[('installation_id.warehouse_id','=',2)]" help="Wetteren Interventions"/>
               			</group>
	                    <group expand="0" string="Group By...">
	                        <filter string="Technician" icon="terp-personal" domain="[]" context="{'group_by':'technicians'}"/>
	                        <filter string="Installation" icon="terp-product" domain="[]" context="{'group_by':'installation_id'}"/>
	                        <filter string="Warehouse" domain="[]" context="{'group_by':'installation_warehouse_id'}"/>
	                        <filter string="Address" icon="terp-personal+" domain="[]" context="{'group_by':'address_id'}"/>
	                        <filter string="Customer" icon="terp-partner" domain="[]" context="{'group_by':'partner_id'}"/>
	                        <filter string="States" domain="[]" context="{'group_by':'state'}"/>
	                        <filter string="Type" domain="[]" context="{'group_by':'maint_type'}"/>
	                        <filter string="Task state" domain="[]" context="{'group_by':'task_state'}"/>
	                    </group>
	                </search>
                </search>
            </field>
        </record>
		
		<record id="elneo_views_maintenance_intervention_tree" model="ir.ui.view">
			<field name="name">elneo.views.maintenance.intervention.tree</field>
			<field name="model">maintenance.intervention</field>
			<field name="inherit_id" ref="elneo_maintenance.view_maintenance_intervention_elneo_tree"/>
			<field name="type">tree</field>
			<field name="arch" type="xml">
				<field name="code" position="replace"/>
				<field name="maint_type" position="replace"/>
				<field name="time_planned" position="replace"/>
				<field name="date_scheduled" position="replace"/>
				<field name="technicians" position="replace"/> 
				<field name="installation_id" position="replace"/>
				<field name="contact_phone" position="replace"/>
				<field name="date_start" position="replace"/>
				<field name="state" position="replace"/>
				<field name="name" position="replace"/>		 			
				<field name="address_id" position="replace"/>			
			
				<tree position="attributes">
					<attribute name="colors">Magenta:blocked;blue:not blocked and state in ('draft');grey:not blocked and state in ('cancel');OrangeRed:not blocked and state not in ('cancel', 'done') and not date_start;red:not blocked and state not in ('cancel', 'done') and date_start &lt; current_date;DarkGreen:not blocked and state not in ('cancel', 'done') and date_start_date and date_start_date == current_date;</attribute>
					<attribute name="default_order">code desc</attribute>
				</tree>			
			
				<tree position="inside">
					<field name="code"/>
				 	<field name="maint_type"/>
					<field name="time_planned"/>
					<field name="date_scheduled"/>
					<field name="technicians"/>	
					<field name="installation_id"/>
					<field name="contact_phone"/>
					<field name="date_start"/>
					<field name="state"/>
					<field name="name"/>
					<field name="address_id"/>
					<field name="blocked" invisible="1"/>
					<field name="date_start_date" invisible="1"/>
				</tree>

			</field>
		</record>
        
		<record id="elneo_views_maintenance_intervention_form" model="ir.ui.view">
			<field name="name">elneo.views.maintenance.intervention.form</field>
			<field name="model">maintenance.intervention</field>
			<field name="inherit_id" ref="maintenance.view_maintenance_intervention_form"/>
			<field name="type">form</field>
			<field name="arch" type="xml">
				<form position="replace">
					<form string="Intervention">
						<header>
							<button name="action_cancel" type="object" string="Cancel" states="draft,confirmed" groups="maintenance.group_maintenance_manager"/>
							<button name="action_confirm" type="object" string="Confirm" states="draft" groups="maintenance.group_maintenance_manager" class="oe_highlight"/>
							<button name="action_done" type="object" string="Done" states="confirmed" class="oe_highlight"/>
							<button name="print_intervention" string="Print" type="object" class="oe_highlight" groups="maintenance.group_maintenance_user"/>
							<button name="print_installation" string="Print Installation" type="object" groups="maintenance.group_maintenance_user"/>
							<field  name="state" widget="statusbar" statusbar_visible="draft,confirmed,done" statusbar_colors='{"confirmed":"blue"}'/>
						</header>
						<sheet>
							<h1>
								<label class="oe_edit_only" for="code" string="Reference"/>
								<field name="code" class="oe_inline"/>
							</h1>
							<div class="oe_right oe_button_box">
		                    </div>
							<group>
								<group>
									<field name="maint_type" widget="selection" />
									<field name="date_scheduled" />
									<field name="date_start" />
									<field name="date_end" />
									<field name="time_planned" widget="float_time" />
									<field name="task_state"/>
									<field name="to_plan" invisible="1" />
								</group>
								<group>	
									<field name="installation_id"/>
									<field name="partner_id" invisible="1"/>
									<field name="contact_address_id" context="{'search_default_parent_id':partner_id}"/>
									<field name="sale_order_id"/>
									<field name="is_reparation" invisible="1"/>
									<field name="failure_type_id" attrs="{'readonly':[('is_reparation','=',False)]}"/>
									<field name="failure_element_id" domain="[('installation_id','=',installation_id)]" attrs="{'readonly':[('is_reparation','=',False)]}"/>
									
								</group>
								<group>
									<separator string="Description" colspan="2"/>
									<field name="name" nolabel="1"/>
								</group>
							</group>
							<notebook name="notebook" colspan="4">
								<page string="Content">
									<separator string="Spare parts" colspan="4" />
									<field name="partner_id" invisible="True" />
									<field name="intervention_products" colspan="4" nolabel="1">
										<form>
											<group>
												<field name="product_id" colspan="4" />
												<field name="description" colspan="4" />
												<field name="quantity" />
											</group>
											<group>
											<field name="maintenance_element_id"
												domain="[('installation_id','=',parent.installation_id)]" />
											</group>
											<group>
												<field name="sale_price" />
												<field name="cost_price" />
												<field name="discount" />
												<field name="delay" />	
												<field name="route_id" />
											</group>
										</form>
										<tree string="Spare parts" >
											<field name="description" />
											<field name="product_id" />
											<field name="quantity" />
											<field name="int_move_availability" />
											<field name="sale_price" />
											<field name="cost_price" />
											<field name="discount" />
											<field name="delay" />
											<field name="maintenance_element_id" />
										</tree>
									</field>
								</page>							
								<page string="Achievement">
									<newline />
									<separator string="Tasks" colspan="4" />
									<field name="tasks" colspan="4" nolabel="1">
										<form>
											<separator string="Task" colspan="4" />
											<group>
												<field name="user_id" string="Technician" />
												<field name="name" />
											</group>
											<separator string="Scheduling" colspan="4" />
											<group>
												<field name="date_start" string="Beginning of task" />
												<field name="planned_hours" string="Planned/worked hours" widget="float_time" />
												<field name="date_end" string="End of task" />
												<field name="break_time" widget="float_time" />
											</group>
										</form>
										<tree string="Tasks">
											<field name="user_id" string="Technician" />
											<field name="name" />
											<field name="date_start" string="Beginning of task" />
											<field name="date_end" string="End of task" />
											<field name="break_time" widget="float_time" />
											<field name="planned_hours" string="Planned/worked hours" widget="float_time" />
										</tree>
									</field>
								</page>
								<page string="Comments">
									<separator string="External comment" colspan="4"/>
									<field name="ext_comment" colspan="4" nolabel="1"/>							
									<newline/>
									<group colspan="2" col="2">
										<separator string="Internal comment" colspan="2"/>
										<field name="int_comment" colspan="2" nolabel="1"/>
									</group>
								</page>
								<div class="oe_right oe_button_box" position="inside">
                    				<button class="oe_inline oe_stat_button oe_right" name="add_todo" string="Add Todo" Help="Click if you want to ask a todo"
                           				type="object" icon="fa-tasks" widget="statinfo"/>
                				</div>
								<page string="Todo's">
									<separator string="Todo's assigned to this intervention"/>
									<span class="oe_grey">Here are todo's that are assigned by manager to this intervention</span>
									<field name="todo_assigned_ids" options="{'reload_on_button': true}"/>
									<separator string="Other todo's for the installation"/>
									<span class="oe_grey">Here are todo's that are linked to the installation</span>
									<div class="oe_right">
										<button class="oe_inline oe_stat_button oe_right" name="assign_todo" string="Assign Not Ready" Help="Click if you want to assign todo's that are not ready to this intervention"
			                           type="object" icon="fa-reply" widget="statinfo"/>
										<button class="oe_inline oe_stat_button oe_right" name="assign_all_todo" string="Assign All" Help="Click if you want to assign all todo's to this intervention"
			                           type="object" icon="fa-reply-all" widget="statinfo"/>
									</div>
									<field name="todo_ids" options="{'reload_on_button': true}"/>
								</page>								
							</notebook>
							<div class="oe_chatter">
			                    <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
			                    <field name="message_ids" widget="mail_thread"/>
			                </div>
		                </sheet>
					</form>
				</form>
			</field>
		</record>
		
		<record id="elneo_views_maintenance_intervention_calendar" model="ir.ui.view">
            <field name="name">elneo.views.intervention.calendar</field>
            <field name="model">maintenance.intervention</field>
            <field name="inherit_id" ref="maintenance.view_maintenance_intervention_calendar"/>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
            	<calendar position="replace">
	                <calendar color="maint_type" date_start="date_start" date_stop="date_end" string="Intervention">
	                	<field name="code"/>
	                    <field name="name"/>
	                    <field name="maint_type"/>
	                </calendar>
                </calendar>
            </field>
        </record>
	</data>
</openerp>