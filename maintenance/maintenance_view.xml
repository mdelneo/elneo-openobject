<?xml version="1.0" encoding="utf-8"?>
<openerp>
	<data>
		<!-- MAIN MAINTENANCE MENU -->
		<menuitem icon="terp-partner" id="menu_maintenance" name="Maintenance"
			sequence="10" groups="group_maintenance_user" />
			
		<!-- MAINTENANCE CONFIGURATION MENU -->
		<menuitem id="menu_maintenance_config" parent="menu_maintenance" 
			name="Configuration" sequence="20" groups="group_maintenance_user" />
			
			
		<record id="view_maintenance_intervention_type_form" model="ir.ui.view">
			<field name="name">maintenance.intervention.type.form</field>
			<field name="model">maintenance.intervention.type</field>
			<field name="type">form</field>
			<field name="arch" type="xml">
				<form string="Maintenance intervention type">
					<field name="name" />
					<field name="color" />
					<field name="workforce_product_id" />
					<field name="workforce_product_duration" widget="float_time" />
				</form>
			</field>
		</record>
			
		<record id="action_maintenance_intervention_type" model="ir.actions.act_window">
			<field name="name">Maintenance intervention type</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">maintenance.intervention.type</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form</field>
		</record>
		
		<menuitem action="action_maintenance_intervention_type" id="menu_maintenance_intervention_type"
			parent="menu_maintenance_config" />

		<!-- MAINTENANCE ELEMENTS -->
		<record id="search_maintenance_element" model="ir.ui.view">
			<field name="name">maintenance.element.search</field>
			<field name="model">maintenance.element</field>
			<field name="type">search</field>
			<field name="arch" type="xml">
				<search string="Maintenance Elements">
					<field name="installation_id" />
					<field name="code" />
					<field name="name" />
					<field name="serial_number" />
					<field name="partner_id" />
					<field name="address_id" />
					<field name="product_id" />
					<field name="installation_date" />
					<field name="warranty_date" />
					<field name="warehouse_id" widget="selection" />
					<newline/>
                    <group expand="0" string="Group By...">
                    	<filter string="Installation"
                            icon="terp-stock_symbol-selection"
                            domain="[]" context="{'group_by':'installation_id'}" />
                        
                    </group>
				</search>
			</field>
		</record>


		<record id="action_maintenance_element" model="ir.actions.act_window">
			<field name="name">Maintenance elements</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">maintenance.element</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form</field>
			<field name="help">All maintenance elements</field>
		</record>
		<menuitem action="action_maintenance_element" id="menu_maintenance_element"
			parent="menu_maintenance" />
		<record id="view_maintenance_element_tree" model="ir.ui.view">
			<field name="name">maintenance.element.tree</field>
			<field name="model">maintenance.element</field>
			<field name="type">tree</field>
			<field name="arch" type="xml">
				<tree string="Maintenance Element">
					<field name="installation_id" />
					<field name="code" />
					<field name="name" />
					<field name="serial_number" />
					<field name="partner_id" />
					<field name="address_id" />
					<field name="product_id" />
					<field name="installation_date" />
					<field name="warranty_date" />
				</tree>
			</field>
		</record>
		<record id="view_maintenance_element_form" model="ir.ui.view">
			<field name="name">maintenance.element.form</field>
			<field name="model">maintenance.element</field>
			<field name="type">form</field>
			<field name="arch" type="xml">
				<form string="Maintenance Element">
					<field name="code" />
					<field name="name" />
					<field name="active" />
					<field name="serial_number" />
					<group col="4" colspan="2">
						<field name="serialnumber_required" />
						<field name="visible_for_intervention" />
					</group>
					<newline />
					<field name="installation_id" />
					<newline />
					<field name="location" />
					<field name="installation_date" />
					<field name="warranty_date" />
					<field name="product_id" />
					<newline />
					<field name="description" colspan="4" />
					<field name="suivi_tmi" colspan="4" />
					<field name="piece_tmi" colspan="4" />
				</form>
			</field>
		</record>

		<!-- MAINTENANCE INSTALLATION -->

		<record id="search_maintenance_installation" model="ir.ui.view">
			<field name="name">maintenance.installation.search</field>
			<field name="model">maintenance.installation</field>
			<field name="type">search</field>
			<field name="arch" type="xml">
				<search string="Maintenance installations">
					<field name="code" />
					<field name="name" />
					<field name="address_id" />
					<field name="partner_id" />
					<field name="contact_address_id" />
					<field name="warehouse_id" />
				</search>
			</field>
		</record>

		<record id="action_maintenance_installation" model="ir.actions.act_window">
			<field name="name">Maintenance installations</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">maintenance.installation</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form</field>
			<field name="help">All maintenance installations</field>
		</record>

		<menuitem action="action_maintenance_installation" id="menu_maintenance_installation"
			parent="menu_maintenance" />
		<record id="view_maintenance_installation_tree" model="ir.ui.view">
			<field name="name">maintenance.installation.tree</field>
			<field name="model">maintenance.installation</field>
			<field name="type">tree</field>
			<field name="arch" type="xml">
				<tree string="Maintenance installation">
					<field name="code" />
					<field name="name" />
					<field name="address_id" />
					<field name="partner_id" />
					<field name="warehouse_id" />
				</tree>
			</field>
		</record>
		<record id="view_maintenance_installation_form" model="ir.ui.view">
			<field name="name">maintenance.installation.form</field>
			<field name="model">maintenance.installation</field>
			<field name="type">form</field>
			<field name="arch" type="xml">
				<form string="Maintenance installation">
					<field name="code" />
					<field name="name" />
					<field name="partner_id"
						on_change="on_change_partner_id(partner_id, invoice_address_id, address_id)" />
					<field name="address_id" domain="[('partner_id','=',partner_id), ('type','in', ('default','delivery'))]" />
					<field name="invoice_address_id" domain="[('partner_id','=',partner_id), ('type','in', ('default','invoice'))]" />
					<field name="contact_address_id" domain="[('type','in', ('default','contact'))]" />
					<field name="warehouse_id" widget="selection" />
					<field name="active" />
					<newline />
					<notebook colspan="4">
						<page string="Content">
							<separator string="Elements" colspan="4" />
							<field name="elements" nolabel='1' colspan="4">
								<tree string="Maintenance Element">
									<field name="code" />
									<field name="name" />
									<field name="serial_number" />
									<field name="product_id" />
									<field name="installation_date" />
									<field name="warranty_date" />
								</tree>
								
								<form string="Maintenance Element">
									<field name="code" />
									<field name="name" />
									<field name="active" />
									<field name="serial_number" />
									<group col="4" colspan="2">
										<field name="serialnumber_required" />
										<field name="visible_for_intervention" />
									</group>
									<newline />
									<field name="partner_id" />
									<newline />
									<field name="address_id" domain="[('partner_id','=',partner_id)]" />
									<newline />
									<field name="location" />
									<field name="installation_date" />
									<field name="warranty_date" />
									<field name="product_id" />
									<newline />
									<field name="description" colspan="4" />
									<field name="suivi_tmi" colspan="4" />
								</form>
							</field>
						</page>
						<page string="History">
							<separator string="Interventions" colspan="4" />
							<field name="interventions" nolabel='1' colspan="4" />
						</page>
					</notebook>
					<group name="transitions" colspan="4" col="4">
						<button name="installation_active" states="inactive" string="Activate" colspan="2" icon="gtk-apply" />
						<button name="installation_inactive" states="active" string="Deactivate" colspan="2" icon="gtk-cancel" />
					</group>
					<field name="state" colspan="2" />
				</form>
			</field>
		</record>


		<!-- MAINTENANCE INTERVENTION -->
		<record id="view_maintenance_intervention_search" model="ir.ui.view">
            <field name="name">maintenance.intervention.search</field>
            <field name="model">maintenance.intervention</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Maintenance intervention">
                    <group col="8" colspan="4">
                        <filter icon="terp-camera_test" name="to_confirm" string="To confirm" domain="[('state','=','draft')]" />
                        <filter icon="terp-camera_test" name="done" string="Finished" domain="[('state','=','done')]" />
                        <separator orientation="vertical"/>
                        <field name="code" />
						<field name="name" />
						<field name="installation_id" />
						<field name="technicians" />					
						<field name="address_id" />
						<field name="partner_id" />
						<field name="state" />
						<field name="task_state" />
						<!--<field name="sale_order_id" />-->
                    </group>
                    <newline/>
                    <group expand="0" string="Group By...">
                        <filter string="Technician" icon="terp-personal" domain="[]" context="{'group_by':'technicians'}"/>
                        <filter string="Installation" icon="terp-product" domain="[]" context="{'group_by':'installation_id'}"/>
                        <filter string="Address" icon="terp-personal+" domain="[]" context="{'group_by':'address_id'}"/>
                        <filter string="Customer" icon="terp-partner" domain="[]" context="{'group_by':'partner_id'}"/>
                        <filter string="State" domain="[]" context="{'group_by':'state'}"/>
                        <filter string="Task state" domain="[]" context="{'group_by':'task_state'}"/>
                    </group>
                </search>
            </field>
        </record>

		<record id="action_maintenance_intervention" model="ir.actions.act_window">
			<field name="name">Maintenance interventions</field>
			<field name="search_view_id" ref="maintenance.view_maintenance_intervention_search" />
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">maintenance.intervention</field>
			<field name="context">{'maintenance_intervention':True}</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form</field>
			<field name="context">{'search_default_future': 1}</field>
			<field name="help">All maintenance interventions</field>
		</record>

		<menuitem action="action_maintenance_intervention" id="menu_maintenance_intervention"
			parent="menu_maintenance" />
			
		
		

		<record id="view_maintenance_intervention_tree" model="ir.ui.view">
			<field name="name">maintenance.intervention.tree</field>
			<field name="model">maintenance.intervention</field>
			<field name="type">tree</field>
			<field name="arch" type="xml">
				<tree string="Maintenance intervention">
					<field name="code" />
					<field name="maint_type" />
					<field name="time_planned" />					
					<field name="technicians" />
					<field name="installation_id" />
					<field name="contact_phone" />
					<field name="date_start" />
					<field name="state" />
					<field name="name" />
					<field name="address_id" />
				</tree>
			</field>
		</record>
		<record id="view_maintenance_intervention_form" model="ir.ui.view">
			<field name="name">maintenance.intervention.form</field>
			<field name="model">maintenance.intervention</field>
			<field name="type">form</field>
			<field name="arch" type="xml">
				<form string="Maintenance intervention">
					<group col="6">
						<field name="code" />
						<field name="maint_type" widget="selection" />
						<field name="date_start" />
						<newline />
						<field name="installation_id" on_change="on_change_installation_id(installation_id)" />
						<field name="partner_id" invisible="True" />
						<field name="contact_address_id" domain="[('partner_id','=',partner_id)]" />
						<newline />
						<field name="time_planned" widget="float_time" />
						<field name="to_plan" invisible="1" />
					</group>
					<notebook colspan="4">
						<page string="Achievement">
							<newline />
							<separator string="Tasks" colspan="4" />
							<field name="tasks" colspan="4" nolabel="1">
								<form>
									<field name="user_id" string="Technician" />
									<field name="name" />
									<field name="date_start" string="Beginning of task" />
									<field name="planned_hours" string="Planned/worked hours" widget="float_time" />
									<field name="date_end" on_change="on_change_date_end(date_start,date_end,break_time)" string="End of task" />
									<field name="break_time" widget="float_time" on_change="on_change_date_end(date_start,date_end,break_time)" />
								</form>
								<tree string="Tasks">
									<field name="user_id" string="Technician" />
									<field name="name" />
									<field name="date_start" string="Beginning of task" />
									<field name="date_end" string="End of task" />
									<field name="break_time" widget="float_time" />
									<field name="planned_hours" string="Planned/worked hours" widget="float_time" />
								</tree>
							</field>
						</page>
						<page string="Comments">
							<separator string="External comment" colspan="4"/>
							<field name="ext_comment" colspan="4" nolabel="1"/>							
							<newline/>
							<group colspan="2" col="2">
								<separator string="Internal comment" colspan="2"/>
								<field name="int_comment" colspan="2" nolabel="1"/>
							</group>
							<group colspan="2" col="2">
								<separator string="Description" colspan="2"/>
								<field name="name" nolabel="1"/>
							</group>
						</page>
					</notebook>
					
					<group col="8">
<!-- 						<button name="action_cancel" type="object" string="Cancel" states="draft,confirmed,done" icon="gtk-cancel" colspan="2" /> -->
						<button name="action_confirm" type="object" string="Confirm" states="draft" icon="gtk-apply" colspan="2" />
						<separator colspan="6" /><button name="action_done" type="object" string="Done" states="confirmed" icon="gtk-ok" colspan="2" />
					</group>
					
					<newline />
					<group col="4">
						<field name="state" colspan="2" />
						<field name="task_state" colspan="2" />
					</group>
				</form>
			</field>
		</record>
	</data>
</openerp>